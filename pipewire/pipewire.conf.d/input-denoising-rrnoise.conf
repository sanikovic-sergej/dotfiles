context.modules = [
    {
        name = libpipewire-module-filter-chain
        args = {
            node.description = "Noise Canceling source"
            media.name = "Noise Canceling source"
            filter.graph = {
                nodes = [
                    {
                        type = ladspa
                        name = rnnoise
                        plugin = /usr/lib64/ladspa/librnnoise_ladspa.so
                        label = noise_suppressor_mono
                        control = {
                            "VAD Threshold (%)" = 50.0
                            "VAD Grace Period (ms)" = 200
                            "Retroactive VAD Grace (ms)" = 0
                        }
                    },
                    {
                        type = lv2
                        name = gate
                        plugin = "http://calf.sourceforge.net/plugins/Gate"
                        control = {
                            attack = 40.0
                            release = 800.0
                            threshold = 0.125
                            range = 0.0625
                            ratio = 2.0
                            knee = 9.0
                            makeup = 1.0
                        }
                    },
                    {
                        type = lv2
                        name = compressor
                        plugin = "http://calf.sourceforge.net/plugins/Compressor"
                        control = {
                            attack = 20.0
                            release = 100.0
                            threshold = 0.251
                            ratio = 4.0
                            knee = 2.8
                            makeup = 1.0
                        }
                    },
                    {
                        type = lv2
                        name = limiter
                        plugin = "http://calf.sourceforge.net/plugins/Limiter"
                        control = {
                            attack = 5.0
                            release = 5.0
                            limit = 1.0
                        }
                    }
                ]
                links = [
                    { output = "rnnoise:out" input = "gate:inl" },
                    { output = "gate:outl" input = "compressor:inl" },
                    { output = "compressor:outl" input = "limiter:inl" }
                ]
            }
            capture.props = {
                node.name = "capture.rnnoise_source"
                node.passive = true
                audio.rate = 48000
                node.target = "alsa_input.target"  # Replace with your actual mic node
            }
            playback.props = {
                node.name = "rnnoise_source"
                media.class = Audio/Source
                audio.rate = 48000
            }
        }
    }
]
